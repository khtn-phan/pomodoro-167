<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer - Focus & Study</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { transition: background-color 0.7s ease; }
        .progress-ring { transition: stroke-dashoffset 1s linear; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100">
    <audio id="notificationSound">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGGi78OKmVBQLTKXh8bllHAU2kdXy0H4yBSh+zPLaizsKE2Gy6OyiUhIOSJzd8sFsIAUrlNDx3JU5CAdjuO7mnE8SDUuk4fG7aB4FN5HV8tB+MgUofszy2oo6ChJgsOjrrVkVCkup4PG6aR4FN5HV8tCBMQUrgsvy24g3BxZmuO7mnE8SDUuk4PG8aR4FN5HV8tB+MgUofszy2os6ChJgsOjrrlkVCkup4PG6aR4FN5HV8tB+MgUofszy2os6ChJgsOjrrlkVCkup4PG6aR4FN5HV8tB+MgUofszy" type="audio/wav">
    </audio>

    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1 id="mainTitle" class="text-4xl font-bold text-gray-800 mb-2">Pomodoro Timer</h1>
                <p id="mainSubtitle" class="text-gray-600">T·∫≠p trung & H·ªçc t·∫≠p Hi·ªáu qu·∫£</p>
            </div>
            <div class="flex gap-2">
                <!-- Language Button -->
                <button onclick="toggleLanguage()" class="p-3 rounded-lg transition-all bg-white hover:bg-gray-100 shadow-md" title="Switch Language">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </button>
                <!-- Stats Button -->
                <button onclick="toggleStatsView()" class="p-3 rounded-lg transition-all bg-white hover:bg-gray-100 shadow-md" title="Statistics">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </button>
                <!-- Dark Mode Button -->
                <button onclick="toggleDarkMode()" class="p-3 rounded-lg transition-all bg-white hover:bg-gray-100 shadow-md" title="Dark Mode">
                    <svg id="darkModeIcon" class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                    </svg>
                </button>
                <!-- Fullscreen Button -->
                <button onclick="toggleFullscreen()" class="p-3 rounded-lg transition-all bg-white hover:bg-gray-100 shadow-md" title="Fullscreen">
                    <svg id="fullscreenIcon" class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Timer View -->
        <div id="timerView">
            <!-- Mode Selection -->
            <div id="modeCard" class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="grid grid-cols-3 gap-3 mb-4">
                    <button onclick="setMode('25/5')" id="btn-25-5" class="py-3 px-4 rounded-lg font-semibold transition-all bg-green-500 text-white shadow-md">
                        25/5
                    </button>
                    <button onclick="setMode('50/10')" id="btn-50-10" class="py-3 px-4 rounded-lg font-semibold transition-all bg-gray-100 text-gray-700 hover:bg-gray-200">
                        50/10
                    </button>
                    <button onclick="setMode('custom')" id="btn-custom" class="py-3 px-4 rounded-lg font-semibold transition-all bg-gray-100 text-gray-700 hover:bg-gray-200">
                        Custom
                    </button>
                </div>
                <div id="customInputs" class="grid grid-cols-2 gap-4 mt-4 pt-4 border-t hidden">
                    <div>
                        <label id="studyLabel" class="block text-sm font-medium text-gray-700 mb-2">Study (ph√∫t)</label>
                        <input type="number" id="customStudy" value="25" min="1" max="120" onchange="updateCustomTime()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label id="breakLabel" class="block text-sm font-medium text-gray-700 mb-2">Break (ph√∫t)</label>
                        <input type="number" id="customBreak" value="5" min="1" max="60" onchange="updateCustomTime()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                </div>
            </div>

            <!-- Pomodoro Name -->
            <div id="nameCard" class="bg-white rounded-xl shadow-lg p-4 mb-6">
                <div class="flex items-center gap-3">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                    </svg>
                    <input type="text" id="pomodoroName" placeholder="ƒê·∫∑t t√™n cho phi√™n h·ªçc n√†y..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:ring-2 focus:ring-green-500">
                </div>
            </div>

            <!-- Timer Display -->
            <div id="timerCard" class="bg-white rounded-xl shadow-lg p-8 mb-6">
                <div class="text-center mb-6">
                    <div id="statusBadge" class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold mb-4 bg-green-100 text-green-700">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span id="statusText">Th·ªùi gian h·ªçc</span>
                    </div>
                    <p id="sessionName" class="text-lg font-medium text-gray-600"></p>
                </div>

                <!-- Circular Progress -->
                <div class="relative w-64 h-64 mx-auto mb-6">
                    <svg class="transform -rotate-90 w-64 h-64">
                        <circle cx="128" cy="128" r="120" stroke="currentColor" stroke-width="8" fill="transparent" class="text-gray-200"></circle>
                        <circle id="progressCircle" cx="128" cy="128" r="120" stroke="currentColor" stroke-width="8" fill="transparent" class="text-green-500 progress-ring" stroke-linecap="round"></circle>
                    </svg>
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center">
                        <div id="timeDisplay" class="text-6xl font-bold text-gray-800">25:00</div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="flex justify-center gap-4">
                    <button onclick="toggleTimer()" id="playPauseBtn" class="p-4 rounded-full shadow-lg transition-all hover:scale-110 bg-green-500 hover:bg-green-600 text-white">
                        <svg id="playIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <svg id="pauseIcon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </button>
                    <button onclick="resetTimer()" class="p-4 rounded-full bg-gray-200 hover:bg-gray-300 text-gray-700 shadow-lg transition-all hover:scale-110">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Quick Stats -->
            <div id="quickStatsCard" class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p id="completedText" class="text-gray-600 text-sm mb-1">H√¥m nay ƒë√£ ho√†n th√†nh</p>
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <span id="todayCount" class="text-3xl font-bold text-gray-800">0</span>
                            <span class="text-gray-600">pomodoros</span>
                        </div>
                    </div>
                    <button onclick="toggleStatsView()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <span id="viewDetailsText">Xem chi ti·∫øt</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Statistics View -->
        <div id="statsView" class="hidden">
            <div id="statsCard" class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <span id="statsTitle">Th·ªëng k√™ h·ªçc t·∫≠p</span>
                    </h2>
                    <button onclick="toggleStatsView()" class="p-2 rounded-lg hover:bg-gray-100">
                        <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Today Stats -->
                <div class="p-4 rounded-lg mb-6 bg-gradient-to-r from-green-100 to-emerald-100">
                    <h3 id="todayTitle" class="text-lg font-semibold text-gray-800 mb-3">üìÖ H√¥m nay</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p id="totalPomodorosText" class="text-sm text-gray-600">S·ªë Pomodoro</p>
                            <p id="statsTodayCount" class="text-3xl font-bold text-gray-800">0</p>
                        </div>
                        <div>
                            <p id="totalTimeText" class="text-sm text-gray-600">T·ªïng th·ªùi gian</p>
                            <p class="text-3xl font-bold text-gray-800"><span id="statsTodayMinutes">0</span> <span id="minutesText">ph√∫t</span></p>
                        </div>
                    </div>
                </div>

                <!-- History -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span id="historyTitle">L·ªãch s·ª≠ h·ªçc t·∫≠p</span> (<span id="historyDaysCount">0</span> <span id="daysText">ng√†y</span>)
                    </h3>
                    <div id="historyList" class="space-y-3 max-h-96 overflow-y-auto">
                        <p id="noDataText" class="text-gray-600">Ch∆∞a c√≥ d·ªØ li·ªáu h·ªçc t·∫≠p</p>
                    </div>
                </div>

                <button id="clearHistoryBtn" onclick="clearAllHistory()" class="mt-4 w-full py-2 rounded-lg bg-red-100 hover:bg-red-200 text-red-600 font-medium transition-colors hidden">
                    <span id="clearHistoryText">X√≥a to√†n b·ªô l·ªãch s·ª≠</span>
                </button>
            </div>
        </div>

        <!-- Tips -->
        <div class="mt-6 text-center text-gray-600 text-sm">
            <p id="tipText">üí° Tip: H√£y t·∫≠p trung cao ƒë·ªô trong th·ªùi gian h·ªçc v√† ngh·ªâ ng∆°i ƒë·∫ßy ƒë·ªß!</p>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            vi: {
                title: 'Pomodoro Timer',
                subtitle: 'T·∫≠p trung & H·ªçc t·∫≠p Hi·ªáu qu·∫£',
                studyTime: 'Th·ªùi gian h·ªçc',
                breakTime: 'Th·ªùi gian ngh·ªâ',
                completedToday: 'H√¥m nay ƒë√£ ho√†n th√†nh',
                pomodoros: 'pomodoros',
                minutes: 'ph√∫t',
                stats: 'Th·ªëng k√™ h·ªçc t·∫≠p',
                today: 'H√¥m nay',
                history: 'L·ªãch s·ª≠ h·ªçc t·∫≠p',
                days: 'ng√†y',
                noData: 'Ch∆∞a c√≥ d·ªØ li·ªáu h·ªçc t·∫≠p',
                clearHistory: 'X√≥a to√†n b·ªô l·ªãch s·ª≠',
                confirmClear: 'B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠?',
                viewDetails: 'Xem chi ti·∫øt',
                namePlaceholder: 'ƒê·∫∑t t√™n cho phi√™n h·ªçc n√†y...',
                tip: 'üí° Tip: H√£y t·∫≠p trung cao ƒë·ªô trong th·ªùi gian h·ªçc v√† ngh·ªâ ng∆°i ƒë·∫ßy ƒë·ªß!',
                totalPomodoros: 'S·ªë Pomodoro',
                totalTime: 'T·ªïng th·ªùi gian',
                studyMinutes: 'Study (ph√∫t)',
                breakMinutes: 'Break (ph√∫t)'
            },
            en: {
                title: 'Pomodoro Timer',
                subtitle: 'Focus & Study Efficiently',
                studyTime: 'Study Time',
                breakTime: 'Break Time',
                completedToday: 'Completed Today',
                pomodoros: 'pomodoros',
                minutes: 'minutes',
                stats: 'Study Statistics',
                today: 'Today',
                history: 'Study History',
                days: 'days',
                noData: 'No study data yet',
                clearHistory: 'Clear All History',
                confirmClear: 'Are you sure you want to clear all history?',
                viewDetails: 'View Details',
                namePlaceholder: 'Name this study session...',
                tip: 'üí° Tip: Stay focused during study time and take proper breaks!',
                totalPomodoros: 'Pomodoros',
                totalTime: 'Total Time',
                studyMinutes: 'Study (minutes)',
                breakMinutes: 'Break (minutes)'
            }
        };

        // App State
        let appState = {
            mode: '25/5',
            customStudy: 25,
            customBreak: 5,
            isStudying: true,
            timeLeft: 1500,
            isRunning: false,
            darkMode: false,
            showingStats: false,
            pomodoroName: '',
            history: [],
            language: 'vi',
            timerInterval: null
        };

        // Initialize app
        function init() {
            loadFromStorage();
            updateAllUI();
        }

        // Load data from localStorage
        function loadFromStorage() {
            try {
                const savedHistory = localStorage.getItem('pomodoroHistory');
                const savedDarkMode = localStorage.getItem('darkMode');
                const savedLanguage = localStorage.getItem('language');
                
                if (savedHistory) {
                    appState.history = JSON.parse(savedHistory);
                }
                if (savedDarkMode === 'true') {
                    appState.darkMode = true;
                }
                if (savedLanguage) {
                    appState.language = savedLanguage;
                }
            } catch (e) {
                console.error('Error loading from storage:', e);
            }
        }

        // Save data to localStorage
        function saveToStorage() {
            try {
                localStorage.setItem('pomodoroHistory', JSON.stringify(appState.history));
                localStorage.setItem('darkMode', appState.darkMode.toString());
                localStorage.setItem('language', appState.language);
            } catch (e) {
                console.error('Error saving to storage:', e);
            }
        }

        // Get current mode settings
        function getCurrentMode() {
            if (appState.mode === 'custom') {
                return { study: appState.customStudy, break: appState.customBreak };
            }
            const modes = {
                '25/5': { study: 25, break: 5 },
                '50/10': { study: 50, break: 10 }
            };
            return modes[appState.mode];
        }

        // Format time as MM:SS
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
        }

        // Get today's pomodoros
        function getTodayPomodoros() {
            const today = new Date().toDateString();
            return appState.history.filter(function(p) {
                return new Date(p.date).toDateString() === today;
            });
        }

        // Get today's total minutes
        function getTodayMinutes() {
            const todayPomodoros = getTodayPomodoros();
            return todayPomodoros.reduce(function(sum, p) {
                return sum + p.duration;
            }, 0);
        }

        // Get unique study days
        function getStudyDays() {
            const uniqueDays = {};
            appState.history.forEach(function(p) {
                const dateStr = new Date(p.date).toDateString();
                uniqueDays[dateStr] = true;
            });
            const daysArray = Object.keys(uniqueDays);
            daysArray.sort(function(a, b) {
                return new Date(b) - new Date(a);
            });
            return daysArray;
        }

        // Get pomodoros by date
        function getPomodorosByDate(dateString) {
            return appState.history.filter(function(p) {
                return new Date(p.date).toDateString() === dateString;
            });
        }

        // Toggle timer
        function toggleTimer() {
            appState.isRunning = !appState.isRunning;
            
            if (appState.isRunning) {
                document.getElementById('playIcon').classList.add('hidden');
                document.getElementById('pauseIcon').classList.remove('hidden');
                startTimer();
            } else {
                document.getElementById('playIcon').classList.remove('hidden');
                document.getElementById('pauseIcon').classList.add('hidden');
                stopTimer();
            }
        }

        // Start timer
        function startTimer() {
            appState.timerInterval = setInterval(function() {
                if (appState.timeLeft > 0) {
                    appState.timeLeft--;
                    updateTimerDisplay();
                } else {
                    handleTimerComplete();
                }
            }, 1000);
        }

        // Stop timer
        function stopTimer() {
            if (appState.timerInterval) {
                clearInterval(appState.timerInterval);
                appState.timerInterval = null;
            }
        }

        // Handle timer completion
        function handleTimerComplete() {
            document.getElementById('notificationSound').play();
            
            if (appState.isStudying) {
                const pomodoroNameInput = document.getElementById('pomodoroName');
                const newPomodoro = {
                    id: Date.now(),
                    name: pomodoroNameInput.value || 'Unnamed Session',
                    date: new Date().toISOString(),
                    duration: getCurrentMode().study,
                    mode: appState.mode
                };
                appState.history.push(newPomodoro);
                saveToStorage();
                pomodoroNameInput.value = '';
                appState.pomodoroName = '';
            }
            
            appState.isStudying = !appState.isStudying;
            appState.isRunning = false;
            stopTimer();
            
            const mode = getCurrentMode();
            appState.timeLeft = (appState.isStudying ? mode.study : mode.break) * 60;
            
            document.getElementById('playIcon').classList.remove('hidden');
            document.getElementById('pauseIcon').classList.add('hidden');
            
            updateAllUI();
        }

        // Reset timer
        function resetTimer() {
            appState.isRunning = false;
            stopTimer();
            
            const mode = getCurrentMode();
            appState.timeLeft = (appState.isStudying ? mode.study : mode.break) * 60;
            
            document.getElementById('playIcon').classList.remove('hidden');
            document.getElementById('pauseIcon').classList.add('hidden');
            
            updateTimerDisplay();
        }

        // Set mode
        function setMode(newMode) {
            appState.mode = newMode;
            appState.isRunning = false;
            stopTimer();
            appState.isStudying = true;
            
            const mode = getCurrentMode();
            appState.timeLeft = mode.study * 60;
            
            document.
